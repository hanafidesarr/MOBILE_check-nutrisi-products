<ion-header [translucent]="true">

  <ion-toolbar>
    <form class="ion-padding-top"  [formGroup]="ionicForm" (ngSubmit)="submitForm()" novalidate>

      <ion-grid>
        <ion-row>
          <ion-searchbar
            #searchBar
            formControlName="name"
            type="text"
            aria-label="Name"
            placeholder="Cari product kemasan"
            enterkeyhint="Search"
            (ionInput)="handleInput($event)"
            (ionFocus)="onSearchFocus()"
          ></ion-searchbar>
        </ion-row>
        <ion-row class="ion-align-items-center ion-padding-start ion-padding-end" >
          <ion-col size="6">
            <!-- <ion-text color="danger"><p (click)="reloadPage()">Reset Search</p></ion-text> -->
            <ion-button color="light" (click)="reloadPage()" size="small">Clear Search</ion-button>
          </ion-col>
          <ion-col size="6">

            <ion-select justify="end" formControlName="country" (ionChange)="submitForm()" class="ion-no-padding">
              <ion-select-option value="indonesia">Product Indonesia</ion-select-option>
              <ion-select-option value="">Product Dunia</ion-select-option>
            </ion-select>
          </ion-col>
        </ion-row>
      </ion-grid>
    </form>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-card class="ion-no-margin" color="light" *ngIf="search_histories" style="position:absolute; z-index: 99; width: 100%; display: block;">
    <ion-list style="height:auto; overflow: auto;">
      <ion-item *ngFor="let result of results_search_histories; let i = index">
        <ion-label   (click)="addToInput(result)">{{ result }}</ion-label>
        <ion-icon (click)="deleteObjectHistory(i)" color="" slot="end" name="close-outline"></ion-icon>
      </ion-item>
    </ion-list>

  </ion-card>

  
  <div *ngIf="showTextMain && loaded">
    <ion-item><h5 class=" ion-margin-end">Label Product</h5></ion-item>
    <ion-item>
      <ion-grid>
        <ion-row>
          <ion-col size="4">
            <img src="https://static.openfoodfacts.org/images/attributes/nutriscore-a.svg">
          </ion-col>
          <ion-col size="8">
            <div>Label kandungan nutrisi pada product.</div>
            <small>(A) Sangat baik (B) Baik (C) Cukup (D) Kurang </small>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>

    <ion-item>
      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <div>Nilai dampak kemasan pada lingkungan.</div>
            <small>(A) Sangat baik (B) Baik (C) Cukup (D) Kurang </small>
          </ion-col>
          <ion-col size="4">
            <img src="https://static.openfoodfacts.org/images/attributes/ecoscore-a.svg">
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>

    <ion-item>
      <ion-grid>
        <ion-row>
          <ion-col size="4">
            <img src="https://static.openfoodfacts.org/images/attributes/nova-group-1.svg">
          </ion-col>
          <ion-col size="8">
            <div>Proses produksi pada product.</div>
            <small>(1) 1 kali proses (2) 2 kali proses (n) dan seterusnya </small>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
    
  </div>


  <div  *ngIf="product_present else showTest">
    <ion-item class="ion-margin-top ion-text-right">
      <ion-label *ngIf="result_products" class="ion-margin-top ion-text-right">Jumlah : {{result_products.count}}</ion-label>
    </ion-item>
    <ion-list size="6" class="ion-margin-bottom" *ngIf="loaded">
      <ion-card *ngFor="let item of list_products" >
        <ion-grid  (click)="openProduct(item.code)">
          <ion-row>
            <ion-col size="3">
              <img style="border-radius: 10px;" [src]="item.image_front_url || 'https://world.openfoodfacts.org/images/icons/dist/packaging.svg'" class="custom-thumbnail">
            </ion-col>
            <ion-col size="6">
              <!-- <ion-card-subtitle>{{item.id}}</ion-card-subtitle> -->
              <ion-card-subtitle><h6 class="ion-no-margin">{{item.product_name || item?.brands }}</h6></ion-card-subtitle>
              <div class="ion-margin-top ion-margin-bottom">
                <div>Quantity : {{item?.quantity || '-'}}</div>
                <div>Brand : {{item?.brands || '-'}}</div>
              </div>

              <!-- <ion-row>
                <ion-col size="8">
                </ion-col>
                <ion-col size="4">
                  <ion-button expand="block" color="danger">
                    <ion-icon slot="icon-only" name="bookmark" size="small"></ion-icon>
                  </ion-button>
                </ion-col>
              </ion-row> -->
            </ion-col>

            <ion-col size="3">
              <img *ngIf="item['nutriscore_grade']" style="border-radius: 10px;" src="https://static.openfoodfacts.org/images/attributes/nutriscore-{{item['nutriscore_grade']}}.svg">
              <img *ngIf="item['ecoscore_grade']" style="border-radius: 10px;" src="https://static.openfoodfacts.org/images/attributes/ecoscore-{{item['ecoscore_grade']}}.svg">
            </ion-col>
          </ion-row>
        </ion-grid>


      </ion-card>
    </ion-list>
    
  </div>
  
  <ion-list *ngFor="let item of loaderResult">

    <ion-item  *ngIf="!loaded">
      <ion-thumbnail slot="start"  class="custom-thumbnail">
        <ion-skeleton-text [animated]="true"></ion-skeleton-text>
      </ion-thumbnail>
      <ion-label>
        <h3>
          <ion-skeleton-text [animated]="true" style="width: 80%;"></ion-skeleton-text>
        </h3>
        <p>
          <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
        </p>
        <p>
          <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
        </p>
      </ion-label>
    </ion-item>
  </ion-list>
  
  <!-- Add the ion-infinite-scroll component at the bottom of your content -->
  <ion-infinite-scroll  *ngIf="result_products" (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more data..."></ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <ng-template class="" #showTest>
    <ion-item class="ion-text-center ion-margin-top">
      <ion-label>
        <h1>Product tidak tersedia</h1>
        <p class="ion-text-wrap">Coba untuk mencari product di negara lain pada pencarian</p>
      </ion-label>
    </ion-item>
  </ng-template>
  <!-- <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Tab 1</ion-title>
    </ion-toolbar>
  </ion-header> -->
  
</ion-content>
